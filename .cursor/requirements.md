# Требования к проекту VIN Report Bot

## Функциональные требования

### Основной workflow
1. **Пользователь отправляет VIN** → бот создает заявку, отвечает "в работе"
2. **Бот отправляет карточку заявки** в приватный MANAGER_CHAT с кнопками Take/Done hint
3. **Менеджер нажимает "Take"** для назначения заявки себе
4. **Менеджер отвечает на карточку PDF** (отчет Carfax)
5. **Бот пересылает PDF пользователю** и помечает заявку как DONE

### Валидация VIN
- 17 символов
- Исключить I, O, Q
- Регулярное выражение: `^[A-HJ-NPR-Z0-9]{17}$`
- Привести к верхнему регистру, убрать пробелы

### Состояния заявки
- `NEW` - новая заявка
- `TAKEN` - назначена менеджеру
- `DONE` - завершена

### Команды
- `/start` - приветствие пользователя
- `/done <id>` - завершить заявку (только в MANAGER_CHAT с документом)

## Нефункциональные требования

### Технические
- Python 3.11+
- aiogram v3
- SQLAlchemy (async) + aiosqlite
- pydantic-settings для конфигурации
- loguru для логирования
- Type hints везде

### Безопасность
- Не логировать полные PDF
- Не хранить PII кроме user_id
- Логировать только переходы состояний заявок

### Производительность
- Graceful startup/shutdown
- Простой polling (без webhook)
- Конфигурация только через env

## Критерии приемки

### MVP
- [x] Создание заявки по VIN
- [x] Уведомление менеджера
- [x] Назначение заявки
- [x] Отправка PDF пользователю
- [x] Закрытие заявки
- [x] Валидация VIN
- [x] Обработка ошибок

### Nice-to-have
- [ ] Миграции Alembic
- [ ] Переключение на PostgreSQL
- [ ] Rate limiting
- [ ] SLA напоминания
- [ ] S3 хранение PDF
- [ ] Unit тесты
